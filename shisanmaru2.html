<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>資産丸 Royal</title>
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<style>
    /* --- LUXURY THEME VARIABLES --- */
    :root {
        --bg-deep: #001228; /* Deepest Yokohama Navy */
        --bg-navy: #001E43;
        --glass-panel: rgba(20, 30, 50, 0.75);
        --glass-border: rgba(197, 160, 89, 0.3);
        --gold-main: #C5A059;
        --gold-bright: #E5C585;
        --gold-shadow: #8A6E30;
        --text-white: #F0F0F0;
        --text-gold: #D4AF37;
        --nixie-glow: #ff5a00;
        --nixie-off: #3a1a1a;
        --danger: #FF453A;
        --success: #32D74B;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Hiragino Mincho ProN", "Hiragino Sans", sans-serif;
        background: radial-gradient(circle at center top, var(--bg-navy) 0%, var(--bg-deep) 100%);
        color: var(--text-white);
        margin: 0;
        min-height: 100vh;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
        overflow-y: auto;
    }

    /* --- AUTH SCREEN (Fix & Design) --- */
    #auth-screen {
        position: fixed; inset: 0; z-index: 10000;
        background: var(--bg-deep);
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        transition: opacity 0.5s ease;
    }
    #auth-screen.hidden { opacity: 0; pointer-events: none; }
    
    .auth-logo {
        font-size: 32px; font-weight: 700; color: var(--gold-bright);
        text-shadow: 0 2px 10px rgba(197, 160, 89, 0.4);
        margin-bottom: 30px; letter-spacing: 2px; border: 1px solid var(--gold-main);
        padding: 10px 30px; border-radius: 4px;
        background: rgba(0,0,0,0.3);
        box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
    }
    .pin-input {
        background: rgba(0,0,0,0.5); border: 1px solid var(--gold-shadow);
        color: var(--gold-bright); font-size: 24px; padding: 15px; border-radius: 8px;
        width: 220px; text-align: center; letter-spacing: 8px; margin-bottom: 25px;
        font-family: monospace; box-shadow: 0 0 15px rgba(0,0,0,0.5) inset;
    }

    /* --- NIXIE TUBE CLOCK (Hyper Real) --- */
    .nixie-wrapper {
        background: #050505;
        border-top: 2px solid #333; border-bottom: 2px solid #333;
        padding: 20px; margin-bottom: 25px;
        box-shadow: inset 0 0 30px #000;
        position: relative;
        overflow: hidden;
    }
    /* Glass Reflection Overlay */
    .nixie-wrapper::after {
        content: ''; position: absolute; top:0; left:0; right:0; height: 50%;
        background: linear-gradient(to bottom, rgba(255,255,255,0.05), transparent);
        pointer-events: none;
    }
    
    .nixie-row {
        display: flex; justify-content: center; gap: 8px; margin-bottom: 10px;
    }
    .nixie-tube {
        width: 32px; height: 54px;
        background: rgba(20, 10, 10, 0.9);
        border-radius: 6px;
        display: flex; justify-content: center; align-items: center;
        font-family: "Courier New", monospace;
        font-size: 38px; font-weight: bold;
        color: var(--nixie-glow);
        position: relative;
        box-shadow: 
            inset 0 0 10px #000,
            0 0 5px rgba(0,0,0,0.8);
        border: 1px solid rgba(50,20,10,0.5);
    }
    /* Filament Glow */
    .nixie-tube span {
        text-shadow: 
            0 0 4px var(--nixie-glow),
            0 0 10px var(--nixie-glow),
            0 0 20px var(--nixie-glow);
        z-index: 2;
    }
    /* Unlit filament mesh (background texture) */
    .nixie-tube::before {
        content: '8'; position: absolute; color: var(--nixie-off);
        font-size: 38px; opacity: 0.15; z-index: 1; filter: blur(0.5px);
    }
    .nixie-sm .nixie-tube { width: 24px; height: 40px; font-size: 28px; }
    .nixie-sm .nixie-tube::before { font-size: 28px; }
    
    .nixie-sep { color: var(--gold-shadow); align-self: flex-end; padding-bottom: 10px; opacity: 0.5; }

    /* --- LAUNCHER --- */
    #p-launcher { padding-top: max(20px, env(safe-area-inset-top)); }
    
    #launcher-grid {
        display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; padding: 0 20px 20px;
    }
    .app-icon {
        aspect-ratio: 1.1;
        background: linear-gradient(145deg, rgba(255,255,255,0.08) 0%, rgba(0,0,0,0.4) 100%);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        transition: all 0.2s ease;
        position: relative; overflow: hidden;
    }
    /* Gold Shine Effect */
    .app-icon::before {
        content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
        background: linear-gradient(45deg, transparent, rgba(197,160,89,0.1), transparent);
        transform: rotate(45deg); opacity: 0; transition: 0.4s;
    }
    .app-icon:active { transform: scale(0.96); border-color: var(--gold-bright); }
    .app-icon:active::before { opacity: 1; }
    
    .icon-symbol { font-size: 42px; margin-bottom: 10px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5)); }
    .icon-label { font-size: 13px; font-weight: 600; color: var(--gold-bright); letter-spacing: 0.5px; text-transform: uppercase;}

    /* --- SHARED UI --- */
    .page { display: none; padding: 20px; padding-top: max(20px, env(safe-area-inset-top)); padding-bottom: 100px; animation: slideUp 0.4s cubic-bezier(0.2, 1, 0.2, 1); }
    .page.active { display: block; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

    h2 {
        font-family: "Hiragino Mincho ProN", serif;
        font-size: 22px; color: var(--gold-bright); margin: 0 0 15px 0;
        border-bottom: 1px solid var(--gold-shadow); padding-bottom: 8px;
        display: flex; justify-content: space-between; align-items: center;
    }

    .card {
        background: var(--glass-panel);
        backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
        border: 1px solid var(--glass-border);
        border-radius: 12px; padding: 16px; margin-bottom: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }

    /* --- B/S Visuals --- */
    .bs-frame { display: flex; gap: 8px; }
    .bs-col { flex: 1; display: flex; flex-direction: column; gap: 4px; }
    .bs-title { font-size: 11px; color: var(--gold-shadow); text-align: center; margin-bottom: 5px; letter-spacing: 1px; }
    .bs-item {
        padding: 12px; border-radius: 4px; text-align: center;
        border: 1px solid rgba(255,255,255,0.05); position: relative;
    }
    .bs-item-val { font-size: 15px; font-weight: bold; font-family: "Hiragino Sans", sans-serif; display: block;}
    .bs-item-lbl { font-size: 10px; color: #ccc; display: block; margin-top: 2px;}
    
    .zone-asset .bs-item { background: linear-gradient(to bottom, rgba(50, 215, 75, 0.1), rgba(50, 215, 75, 0.05)); border-left: 2px solid var(--success); }
    .zone-debt .bs-item { background: linear-gradient(to bottom, rgba(255, 69, 58, 0.1), rgba(255, 69, 58, 0.05)); border-left: 2px solid var(--danger); }
    .zone-net .bs-item { background: linear-gradient(to bottom, rgba(197, 160, 89, 0.2), rgba(197, 160, 89, 0.05)); border-left: 2px solid var(--gold-bright); border: 1px solid var(--gold-main); flex:1; display: flex; flex-direction: column; justify-content: center;}

    /* --- INPUTS & BUTTONS --- */
    input, select {
        background: rgba(0,0,0,0.6); border: 1px solid var(--gold-shadow); color: white;
        padding: 12px; border-radius: 6px; width: 100%; font-size: 16px; box-sizing: border-box; margin-bottom: 8px;
    }
    .btn {
        width: 100%; padding: 14px; border-radius: 6px; border: none;
        font-weight: bold; font-size: 14px; cursor: pointer; margin-top: 10px;
        text-transform: uppercase; letter-spacing: 1px; transition: 0.2s;
    }
    .btn-gold { 
        background: linear-gradient(to bottom, var(--gold-bright), var(--gold-main)); 
        color: #1a0f00; text-shadow: 0 1px 0 rgba(255,255,255,0.4);
        box-shadow: 0 4px 15px rgba(197, 160, 89, 0.3);
    }
    .btn-gold:active { transform: translateY(1px); box-shadow: 0 2px 5px rgba(197, 160, 89, 0.3); }

    /* --- HOME BUTTON --- */
    #home-btn {
        position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
        width: 60px; height: 60px;
        background: rgba(0, 30, 67, 0.95);
        border: 2px solid var(--gold-main);
        border-radius: 50%;
        display: flex; justify-content: center; align-items: center;
        box-shadow: 0 0 20px rgba(197, 160, 89, 0.2), 0 5px 15px rgba(0,0,0,0.5);
        z-index: 900;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        opacity: 0; pointer-events: none; transform: translateX(-50%) translateY(20px);
    }
    #home-btn.visible { opacity: 1; pointer-events: auto; transform: translateX(-50%) translateY(0); }
    #home-btn i { font-size: 26px; color: var(--gold-bright); }
    #home-btn:active { transform: translateX(-50%) scale(0.9); background: var(--gold-main); }
    #home-btn:active i { color: #000; }

    /* --- FOOTER --- */
    .copyright {
        text-align: center; margin-top: 40px; color: var(--gold-shadow); opacity: 0.6;
        font-family: monospace; font-size: 10px; letter-spacing: 1px;
    }
</style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-logo">資産丸 ROYAL</div>
    <div style="color:var(--gold-shadow); font-size:12px; margin-bottom:10px; letter-spacing:2px;">SECURITY CHECK</div>
    <input type="password" id="auth-input" class="pin-input" pattern="[0-9]*" inputmode="numeric" placeholder="****">
    <button class="btn btn-gold" style="width:220px;" onclick="tryLogin()" id="auth-btn">UNLOCK</button>
</div>

<div id="home-btn" onclick="goHome()">
    <i class="ri-anchor-fill"></i>
</div>

<div id="p-launcher" class="page">
    <div class="nixie-wrapper">
        <div class="nixie-row" id="nixie-date">
            </div>
        <div class="nixie-row nixie-sm" id="nixie-time">
            </div>
    </div>

    <div id="launcher-grid"></div>
</div>

<div id="p-bs" class="page">
    <h2>
        <span>貸借対照表 (B/S)</span>
        <i class="ri-scales-3-line"></i>
    </h2>
    <div id="bs-container"></div>
</div>

<div id="p-pl" class="page">
    <h2>
        <span>損益計算書 (P/L)</span>
        <i class="ri-bar-chart-grouped-line"></i>
    </h2>
    <div id="pl-container"></div>
</div>

<div id="p-calendar" class="page">
    <h2>
        <span>資金カレンダー</span>
        <i class="ri-calendar-2-line"></i>
    </h2>
    <div class="card" style="text-align:center;">
        <div id="cal-grid" style="display:grid; grid-template-columns:repeat(7,1fr); gap:6px; margin-top:10px;"></div>
    </div>
</div>

<div id="p-assets" class="page">
    <h2>資産台帳編集</h2>
    <div id="asset-list"></div>
    <button class="btn btn-gold" onclick="addAsset()">＋ 新規項目</button>
</div>

<div id="p-flows" class="page">
    <h2>資金フロー編集</h2>
    <div id="flow-list"></div>
    <button class="btn btn-gold" onclick="addFlow()">＋ 新規フロー</button>
</div>

<div id="p-settings" class="page">
    <h2>
        <span>システム設定</span>
        <i class="ri-settings-5-line"></i>
    </h2>
    
    <div class="card">
        <div class="bs-title" style="text-align:left; margin-bottom:10px;">ランチャー並び替え</div>
        <div id="order-list"></div>
    </div>

    <div class="card">
        <div class="bs-title" style="text-align:left; margin-bottom:10px;">セキュリティ</div>
        <button class="btn btn-gold" style="background:#333; color:white; box-shadow:none; border:1px solid #555;" onclick="resetPass()">パスワードリセット</button>
    </div>

    <div class="copyright">
        AssetMaru v3.0 Royal Edition<br>
        Dev by Y.T<br>
        &copy; 2026 Y.T All Rights Reserved.
    </div>
</div>

<script>
    /* --- DATA & CONFIG --- */
    const KEY_DATA = 'am_royal_data';
    const KEY_PASS = 'am_royal_pass';
    
    // App Config
    const APPS = {
        'bs': { name: '貸借対照表', icon: 'ri-scales-3-fill', color: '#C5A059' },
        'pl': { name: '損益計算書', icon: 'ri-funds-box-fill', color: '#32D74B' },
        'calendar': { name: 'カレンダー', icon: 'ri-calendar-event-fill', color: '#FF453A' },
        'assets': { name: '資産管理', icon: 'ri-safe-2-fill', color: '#E5C585' },
        'flows': { name: 'フロー設定', icon: 'ri-exchange-dollar-fill', color: '#AABbd5' },
        'settings': { name: '設定', icon: 'ri-equalizer-fill', color: '#888' }
    };

    const defaultData = {
        order: ['bs', 'pl', 'calendar', 'assets', 'flows', 'settings'],
        assets: [
            { name:'三井住友(Olive)', type:'asset', val:250000 },
            { name:'楽天証券', type:'asset', val:1500000 },
            { name:'住宅ローン', type:'debt', val:24000000 }
        ],
        flows: [
            { day:25, title:'給与', type:'inc', val:300000 },
            { day:27, title:'ローン返済', type:'exp', val:85000 }
        ]
    };
    
    let data = {};

    /* --- INITIALIZATION --- */
    window.onload = function() {
        // Load Data
        const json = localStorage.getItem(KEY_DATA);
        data = json ? JSON.parse(json) : JSON.parse(JSON.stringify(defaultData));
        if(!data.order) data.order = [...defaultData.order];

        // Auth Logic
        const storedPass = localStorage.getItem(KEY_PASS);
        const btn = document.getElementById('auth-btn');
        const title = document.querySelector('.auth-logo');
        
        if (!storedPass) {
            // Setup Mode
            title.innerText = "INITIAL SETUP";
            btn.innerText = "SET PASSCODE";
            btn.onclick = () => {
                const val = document.getElementById('auth-input').value;
                if(val.length > 0) {
                    localStorage.setItem(KEY_PASS, val);
                    unlockApp();
                }
            };
        } else {
            // Login Mode
            btn.onclick = tryLogin;
        }
        
        // Start Clock
        setInterval(updateNixie, 1000);
        updateNixie();
    };

    function tryLogin() {
        const val = document.getElementById('auth-input').value;
        if(val === localStorage.getItem(KEY_PASS)) {
            unlockApp();
        } else {
            alert('ACCESS DENIED');
            document.getElementById('auth-input').value = "";
        }
    }

    function unlockApp() {
        const screen = document.getElementById('auth-screen');
        screen.classList.add('hidden');
        
        // Wait for transition then remove from display flow if needed (optional)
        setTimeout(() => {
            renderLauncher();
            document.getElementById('p-launcher').classList.add('active');
        }, 300);
    }

    function resetPass() {
        if(confirm('SYSTEM RESET: Are you sure?')) {
            localStorage.removeItem(KEY_PASS);
            location.reload();
        }
    }

    /* --- NIXIE CLOCK RENDERER --- */
    function updateNixie() {
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth()+1).padStart(2,'0');
        const d = String(now.getDate()).padStart(2,'0');
        const H = String(now.getHours()).padStart(2,'0');
        const M = String(now.getMinutes()).padStart(2,'0');
        const S = String(now.getSeconds()).padStart(2,'0');

        const dateHTML = generateTubes(y) + sep() + generateTubes(m) + sep() + generateTubes(d);
        const timeHTML = generateTubes(H) + sep() + generateTubes(M) + sep() + generateTubes(S);

        document.getElementById('nixie-date').innerHTML = dateHTML;
        document.getElementById('nixie-time').innerHTML = timeHTML;
    }

    function generateTubes(str) {
        return str.toString().split('').map(char => `<div class="nixie-tube"><span>${char}</span></div>`).join('');
    }
    function sep() { return `<div class="nixie-sep">-</div>`; }

    /* --- LAUNCHER --- */
    function renderLauncher() {
        const grid = document.getElementById('launcher-grid');
        grid.innerHTML = '';
        data.order.forEach(key => {
            const app = APPS[key];
            grid.innerHTML += `
                <div class="app-icon" onclick="openPage('${key}')">
                    <i class="${app.icon} icon-symbol" style="color:${app.color}"></i>
                    <span class="icon-label">${app.name}</span>
                </div>
            `;
        });
    }

    /* --- NAVIGATION --- */
    window.openPage = (key) => {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById('p-' + key).classList.add('active');
        document.getElementById('p-launcher').classList.remove('active');
        document.getElementById('home-btn').classList.add('visible');

        if(key === 'bs') renderBS();
        if(key === 'pl') renderPL();
        if(key === 'assets') renderAssets();
        if(key === 'flows') renderFlows();
        if(key === 'calendar') renderCalendar();
        if(key === 'settings') renderSettings();
    };

    window.goHome = () => {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById('p-launcher').classList.add('active');
        document.getElementById('home-btn').classList.remove('visible');
        renderLauncher(); // Refresh order
    };

    /* --- APP LOGIC --- */
    
    // B/S Logic
    function renderBS() {
        let assets = 0, debts = 0;
        let aHtml = '', dHtml = '';
        
        data.assets.forEach(a => {
            const val = parseInt(a.val);
            const html = `
                <div class="bs-item">
                    <span class="bs-item-val">¥${val.toLocaleString()}</span>
                    <span class="bs-item-lbl">${a.name}</span>
                </div>`;
            if(a.type === 'asset') { assets += val; aHtml += html; }
            else { debts += val; dHtml += html; }
        });

        const net = assets - debts;
        const netHtml = `
            <div class="bs-item">
                <span class="bs-item-lbl">純資産</span>
                <span class="bs-item-val" style="color:var(--gold-bright); font-size:18px;">¥${net.toLocaleString()}</span>
            </div>`;

        document.getElementById('bs-container').innerHTML = `
            <div class="bs-frame">
                <div class="bs-col zone-asset">
                    <div class="bs-title">ASSETS</div>
                    ${aHtml}
                    <div style="margin-top:auto; text-align:right; font-size:12px; padding:5px; border-top:1px solid #555;">¥${assets.toLocaleString()}</div>
                </div>
                <div class="bs-col zone-debt">
                    <div class="bs-title">DEBT & EQUITY</div>
                    ${dHtml}
                    <div class="zone-net" style="flex:1; display:flex; flex-direction:column; justify-content:end; margin-top:4px;">
                        ${netHtml}
                    </div>
                    <div style="text-align:right; font-size:12px; padding:5px; border-top:1px solid #555;">¥${(debts+net).toLocaleString()}</div>
                </div>
            </div>
            <div class="card" style="margin-top:15px; text-align:center;">
                <span style="font-size:12px; color:#888;">自己資本比率</span>
                <span style="font-size:20px; font-weight:bold; color:var(--gold-bright); margin-left:10px;">
                    ${assets>0 ? Math.round((net/assets)*100) : 0}%
                </span>
            </div>
        `;
    }

    // P/L Logic
    function renderPL() {
        let inc = 0, exp = 0;
        let html = '';
        const sorted = [...data.flows].sort((a,b)=>a.day-b.day);
        
        sorted.forEach(f => {
            const v = parseInt(f.val);
            if(f.type === 'inc') inc += v;
            if(f.type === 'exp') exp += v;
            const color = f.type==='inc' ? 'var(--success)' : (f.type==='exp' ? 'var(--danger)' : '#fff');
            
            html += `
                <div style="display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid rgba(255,255,255,0.05);">
                    <span><span style="color:var(--gold-shadow); font-size:12px; margin-right:8px;">${f.day}日</span> ${f.title}</span>
                    <span style="color:${color}; font-weight:bold;">¥${v.toLocaleString()}</span>
                </div>`;
        });
        
        const prof = inc - exp;
        document.getElementById('pl-container').innerHTML = `
            <div class="card" style="background:rgba(0,0,0,0.4);">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>収入</span> <span style="color:var(--success)">¥${inc.toLocaleString()}</span></div>
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>支出</span> <span style="color:var(--danger)">▲¥${exp.toLocaleString()}</span></div>
                <div style="border-top:1px solid #555; padding-top:10px; display:flex; justify-content:space-between; font-size:18px; font-weight:bold;">
                    <span>収支</span>
                    <span style="color:${prof>=0?'var(--gold-bright)':'var(--danger)'}">¥${prof.toLocaleString()}</span>
                </div>
            </div>
            <div class="card">${html}</div>
        `;
    }

    // Calendar
    function renderCalendar() {
        const grid = document.getElementById('cal-grid');
        grid.innerHTML = '';
        const now = new Date();
        const dim = new Date(now.getFullYear(), now.getMonth()+1, 0).getDate();
        const start = new Date(now.getFullYear(), now.getMonth(), 1).getDay();
        
        for(let i=0; i<start; i++) grid.innerHTML += '<div></div>';
        
        for(let d=1; d<=dim; d++) {
            const hasEvent = data.flows.some(f => parseInt(f.day) === d);
            const bg = hasEvent ? 'var(--gold-bright)' : 'rgba(255,255,255,0.05)';
            const col = hasEvent ? '#000' : '#888';
            grid.innerHTML += `
                <div style="aspect-ratio:1; background:${bg}; color:${col}; border-radius:4px; display:flex; justify-content:center; align-items:center; font-size:12px; font-weight:bold;">
                    ${d}
                </div>
            `;
        }
    }

    // Editors
    function renderAssets() {
        const list = document.getElementById('asset-list');
        list.innerHTML = '';
        data.assets.forEach((a, i) => {
            list.innerHTML += `
                <div class="card">
                    <input type="text" value="${a.name}" onchange="upd('assets',${i},'name',this.value)">
                    <div style="display:flex; gap:10px;">
                        <select onchange="upd('assets',${i},'type',this.value)">
                            <option value="asset" ${a.type==='asset'?'selected':''}>資産 (+)</option>
                            <option value="debt" ${a.type==='debt'?'selected':''}>負債 (-)</option>
                        </select>
                        <input type="number" value="${a.val}" onchange="upd('assets',${i},'val',this.value)">
                    </div>
                    <button class="btn" style="background:var(--danger); margin-top:0; color:white;" onclick="del('assets',${i})">削除</button>
                </div>`;
        });
    }

    function renderFlows() {
        const list = document.getElementById('flow-list');
        list.innerHTML = '';
        data.flows.forEach((f, i) => {
            list.innerHTML += `
                <div class="card">
                    <div style="display:flex; gap:10px;">
                        <input type="number" value="${f.day}" onchange="upd('flows',${i},'day',this.value)" style="width:60px">
                        <input type="text" value="${f.title}" onchange="upd('flows',${i},'title',this.value)">
                    </div>
                    <div style="display:flex; gap:10px;">
                        <select onchange="upd('flows',${i},'type',this.value)">
                            <option value="inc" ${f.type==='inc'?'selected':''}>収入</option>
                            <option value="exp" ${f.type==='exp'?'selected':''}>支出</option>
                            <option value="mov" ${f.type==='mov'?'selected':''}>振替</option>
                        </select>
                        <input type="number" value="${f.val}" onchange="upd('flows',${i},'val',this.value)">
                    </div>
                    <button class="btn" style="background:var(--danger); margin-top:0; color:white;" onclick="del('flows',${i})">削除</button>
                </div>`;
        });
    }

    function renderSettings() {
        const list = document.getElementById('order-list');
        list.innerHTML = '';
        data.order.forEach((key, idx) => {
            const app = APPS[key];
            list.innerHTML += `
                <div style="display:flex; justify-content:space-between; padding:10px; background:rgba(0,0,0,0.3); margin-bottom:5px; border-radius:4px; align-items:center;">
                    <span>${app.name}</span>
                    <div>
                        <button onclick="moveOrder(${idx},-1)" style="background:none; border:none; color:white;">▲</button>
                        <button onclick="moveOrder(${idx},1)" style="background:none; border:none; color:white;">▼</button>
                    </div>
                </div>`;
        });
    }

    /* --- HELPERS --- */
    window.addAsset = () => { data.assets.push({name:'新規項目', type:'asset', val:0}); save(); renderAssets(); };
    window.addFlow = () => { data.flows.push({day:1, title:'新規フロー', type:'exp', val:0}); save(); renderFlows(); };
    window.upd = (k, i, f, v) => { data[k][i][f] = v; save(); };
    window.del = (k, i) => { if(confirm('Delete?')) { data[k].splice(i,1); save(); k==='assets'?renderAssets():renderFlows(); } };
    
    window.moveOrder = (idx, dir) => {
        if((dir===-1 && idx===0) || (dir===1 && idx===data.order.length-1)) return;
        const temp = data.order[idx];
        data.order[idx] = data.order[idx+dir];
        data.order[idx+dir] = temp;
        save(); renderSettings();
    };

    function save() {
        localStorage.setItem(KEY_DATA, JSON.stringify(data));
    }
</script>
</body>
</html>
