<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>TRI-AXIS v1.0.0 | 知の最終武装</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass-bg: rgba(10, 20, 35, 0.45);
            --glass-border: rgba(255, 255, 255, 0.12);
            --neon-blue: #00d9ff;
            --neon-gold: #ffcc00;
            --neon-green: #33ffaa;
            --neon-red: #ff3366;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: #010409; color: #e0e6ed; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; }

        .app-shell { display: flex; flex-direction: column; height: 100vh; padding-top: var(--safe-top); }
        .deep-bg { position: fixed; top:0; left:0; width:100%; height:100%; background: radial-gradient(circle at 50% 50%, #0a1930 0%, #010409 100%); z-index: -1; }

        /* --- Header --- */
        header { padding: 15px 20px; background: var(--glass-bg); backdrop-filter: blur(40px); border-bottom: 1px solid var(--glass-border); }
        .top-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .psi-display { font-family: 'Noto Serif JP', serif; font-size: 1.6rem; color: var(--neon-blue); text-shadow: 0 0 15px rgba(0,217,255,0.5); }
        
        .nav-rail { display: flex; overflow-x: auto; gap: 8px; scrollbar-width: none; }
        .nav-rail::-webkit-scrollbar { display: none; }
        .tab-pill { padding: 8px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 20px; color: #8899aa; font-size: 0.75rem; white-space: nowrap; transition: 0.3s; cursor: pointer; }
        .tab-pill.active { background: var(--neon-blue); color: #000; font-weight: 600; border-color: var(--neon-blue); }

        /* --- Main Workspace --- */
        main { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .view { display: none; animation: slideUp 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .view.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 18px; padding: 20px; margin-bottom: 15px; backdrop-filter: blur(30px); }
        .input-box { margin-bottom: 18px; }
        .input-box label { display: block; font-size: 0.7rem; color: #8899aa; margin-bottom: 8px; letter-spacing: 0.05em; }
        input, select { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 14px; color: #fff; font-size: 1rem; outline: none; }
        
        /* --- MAGI Tribunal --- */
        .magi-triad { position: relative; height: 300px; margin: 20px 0; display: flex; justify-content: center; align-items: center; }
        .core { position: absolute; width: 85px; text-align: center; }
        .core-shape { width: 55px; height: 55px; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; font-family: 'Noto Serif JP'; font-size: 1.3rem; background: rgba(0,0,0,0.4); border: 2px solid; transition: 0.5s; }
        .core-status { font-size: 0.65rem; font-weight: 800; letter-spacing: 0.1em; }
        
        .logos { top: 0; color: var(--neon-gold); }
        .logos .core-shape { transform: rotate(45deg); border-color: var(--neon-gold); box-shadow: 0 0 20px rgba(255,204,0,0.3); }
        .logos .core-shape span { transform: rotate(-45deg); }
        
        .hedon { bottom: 0; right: 15%; color: var(--neon-blue); }
        .hedon .core-shape { clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); border-color: var(--neon-blue); }

        .aegis { bottom: 0; left: 15%; color: var(--neon-green); }
        .aegis .core-shape { clip-path: polygon(0 0, 100% 0, 50% 100%); border-color: var(--neon-green); }

        .rank-center { position: absolute; font-family: 'Noto Serif JP'; font-size: 4rem; text-shadow: 0 0 20px rgba(255,255,255,0.2); }

        /* --- Footer Dock --- */
        footer { position: fixed; bottom: 0; width: 100%; background: var(--glass-bg); backdrop-filter: blur(40px); border-top: 1px solid var(--glass-border); padding: 12px 20px calc(12px + var(--safe-bottom)); display: flex; justify-content: space-around; }
        .dock-item { background: none; border: none; color: #8899aa; font-size: 0.6rem; display: flex; flex-direction: column; align-items: center; gap: 4px; transition: 0.3s; }
        .dock-item.active { color: var(--neon-blue); }
        .dock-icon { width: 22px; height: 22px; stroke: currentColor; fill: none; stroke-width: 1.8; }

        .evidence-text { font-size: 0.85rem; line-height: 1.6; }
        .evidence-text b { color: var(--neon-gold); }
        .law-ref { font-size: 0.65rem; color: #556677; margin-top: 10px; display: block; }
    </style>
</head>
<body>

<div class="deep-bg"></div>

<div class="app-shell">
    <header>
        <div class="top-info">
            <span style="font-size: 0.7rem; color: #556677; letter-spacing: 0.1em;">TRI-AXIS v1.0.0</span>
            <div class="psi-display" id="psi-score">Ψ 0.0</div>
        </div>
        <div class="nav-rail">
            <div class="tab-pill active" onclick="setView('project')">案件管理</div>
            <div class="tab-pill" onclick="setView('property')">物件諸元</div>
            <div class="tab-pill" onclick="setView('location')">立地交通</div>
            <div class="tab-pill" onclick="setView('finance')">財務属性</div>
        </div>
    </header>

    <main>
        <div id="view-property" class="view">
            <div class="card">
                <div class="input-box"><label>物件価格 (万円)</label><input type="number" id="p_price" value="6500" onchange="runAudit()"></div>
                <div class="input-box"><label>専有面積 (㎡)</label><input type="number" id="p_size" value="70" onchange="runAudit()"></div>
                <div class="input-box"><label>修繕積立金 (月額)</label><input type="number" id="p_reserve" value="12000" onchange="runAudit()"></div>
                <div class="input-box"><label>総戸数</label><input type="number" id="p_units" value="50" onchange="runAudit()"></div>
                <div class="input-box"><label>構造</label>
                    <select id="p_structure" onchange="runAudit()">
                        <option value="RC">RC造 (耐震)</option>
                        <option value="TOWER">タワーマンション</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="view-location" class="view">
            <div class="card">
                <div class="input-box"><label>駅徒歩 (分)</label><input type="number" id="l_walk" value="8" onchange="runAudit()"></div>
                <div class="input-box"><label>幹線道路からの距離 (m)</label><input type="number" id="l_road_dist" value="30" onchange="runAudit()"></div>
                <div class="input-box"><label>用途地域</label>
                    <select id="l_zone" onchange="runAudit()">
                        <option value="RES">第一種中高層住居専用</option>
                        <option value="COM">商業地域 (建築リスク高)</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="view-audit" class="view active">
            <div class="magi-triad">
                <div class="core logos"><div class="core-shape"><span>財</span></div><div class="core-status" id="s-logos">-</div></div>
                <div class="core hedon"><div class="core-shape">生</div><div class="core-status" id="s-hedon">-</div></div>
                <div class="core aegis"><div class="core-shape">守</div><div class="core-status" id="s-aegis">-</div></div>
                <div class="rank-center" id="r-final">-</div>
            </div>
            <div class="card evidence-text" id="report-text">
                知的監査エンジンを起動してください。
            </div>
        </div>

        <div id="view-project" class="view">
            <div class="card">未来の資産価値曲線を表示中...</div>
        </div>
    </main>

    <footer>
        <button class="dock-item" onclick="setMode('input')"><svg class="dock-icon"><path d="M12 4v16m8-8H4"/></svg>設定</button>
        <button class="dock-item active" onclick="setMode('audit')"><svg class="dock-icon"><path d="M9 12l2 2 4-4m5.618-4.016A9 9 0 112.862 10.08a9 9 0 0111.756-6.096z"/></svg>診断</button>
        <button class="dock-item" onclick="setMode('map')"><svg class="dock-icon"><path d="M9 20l-5-4V4l5 4m0 12l5-4m-5 4V8m5 8l5 4V8l-5-4m0 12V4"/></svg>地図</button>
        <button class="dock-item" onclick="exportReport()"><svg class="dock-icon"><path d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>共有</button>
    </footer>
</div>

<script>
    /* --- 専門家エンジン・クラス定義 --- */
    class Auditor {
        static logos(p) { // 財務
            const sqmRate = p.reserve / p.size;
            const res = { eval: '可', score: 90, msg: '積立金単価は国交省指針の適正範囲内です。' };
            if (sqmRate < 200) { res.eval = '保'; res.score = 60; res.msg = '積立金が㎡単価200円未満です。将来の増額・一時金リスクを検知。'; }
            if (p.units < 30) { res.score -= 10; res.msg += ' 小規模物件による固定費割高リスクあり。'; }
            return res;
        }
        static hedon(p) { // 生活
            const roadNoise = 75 - 10 * Math.log10(p.roadDist / 1); // 物理学的線音源減衰
            const res = { eval: '可', score: 85, msg: '居住面積水準を満たしています。' };
            if (p.size < 70) { res.eval = '保'; res.msg = '国交省の誘導居住面積水準（3人世帯：75㎡）を僅かに下回ります。'; }
            if (roadNoise > 60) { res.eval = '否'; res.msg = `騒音推計 ${Math.round(roadNoise)}dB。夜間の環境基準値を超過する可能性大。`; }
            return res;
        }
        static aegis(p) { // 守護
            const res = { eval: '可', score: 95, msg: '現行耐震基準に適合し、安全性は高いと判断。' };
            if (p.zone === 'COM') { res.eval = '保'; res.msg = '商業地域のため、隣地への将来的な高層ビル建築による日照侵害リスクあり。'; }
            return res;
        }
    }

    /* --- UI制御 --- */
    function setView(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + id).classList.add('active');
        document.querySelectorAll('.tab-pill').forEach(t => t.classList.remove('active'));
        if (event.target.classList.contains('tab-pill')) event.target.classList.add('active');
    }

    function setMode(mode) {
        if (mode === 'input') setView('property');
        if (mode === 'audit') setView('audit');
        document.querySelectorAll('.dock-item').forEach(d => d.classList.remove('active'));
        event.currentTarget.classList.add('active');
        runAudit();
    }

    function runAudit() {
        const params = {
            price: parseFloat(document.getElementById('p_price').value),
            size: parseFloat(document.getElementById('p_size').value),
            reserve: parseFloat(document.getElementById('p_reserve').value),
            units: parseFloat(document.getElementById('p_units').value),
            roadDist: parseFloat(document.getElementById('l_road_dist').value),
            zone: document.getElementById('l_zone').value
        };

        const l = Auditor.logos(params);
        const h = Auditor.hedon(params);
        const a = Auditor.aegis(params);

        document.getElementById('s-logos').innerText = l.eval;
        document.getElementById('s-hedon').innerText = h.eval;
        document.getElementById('s-aegis').innerText = a.eval;
        
        const totalScore = ((l.score + h.score + a.score) / 3).toFixed(1);
        document.getElementById('psi-score').innerText = `Ψ ${totalScore}`;
        document.getElementById('r-final').innerText = totalScore > 85 ? 'S' : totalScore > 70 ? 'A' : 'B';

        document.getElementById('report-text').innerHTML = `
            <b>◇ 財務:</b> ${l.msg}<br><br>
            <b>⬡ 生活:</b> ${h.msg}<br><br>
            <b>▽ 守護:</b> ${a.msg}
            <span class="law-ref">出典: 国交省マンション修繕積立金ガイドライン / WHO環境騒音基準</span>
        `;
    }

    function exportReport() {
        const txt = `【 TRI-AXIS 監査報告書 】\nスコア: ${document.getElementById('psi-score').innerText}\n判定: ${document.getElementById('r-final').innerText}`;
        navigator.clipboard.writeText(txt).then(() => alert("監査報告書（テキスト）をコピーしました。"));
    }

    window.onload = runAudit;
</script>
</body>
</html>
